#### 简介

k8s作为云原生应用的基础调度平台，相当于云原生的操作系统，为了便于系统的扩展，k8s开发了**容器运行时接口(CRI)** 、**容器网络接口(CNI)** 、**容器存储接口(CSI)** .可以分别对接不同的后端，来实现自己的业务逻辑。



#### 容器运行时

每个节点安装一个容器运行时，用来使Pod可以运行在上面。

##### 容器运行时的分类

官方分为containerd、CRI-O、Docker这几种。这几种是比较高级的容器运行时，也就是比较抽象的，实际上对应的底层具体实现，是有不同的，例如containerd，它的底层实现一般是runc。

只关注正在运行的容器运行时，可以称之为低级容器运行时。它比较关注具体的实现。

支持更多高级功能的容器运行时可以称之为高级容器运行时，它比低级多了一些镜像管理、webApi等，可以理解为是低级容器运行时的抽象。

#### 容器运行时接口(CRI)

CRI中定义了容器和镜像的接口，因为容器运行时与镜像的生命周期是彼此独立的，因此需要两个服务。

CRI是kubelet与容器运行时对接的方式。

CRI使用protocol buffer，基于grpc。

##### CRI架构



![CRI架构](./CRI架构.PNG)

##### CRI接口定义

CRI接口需要实现RuntimeService和ImageManagerService两个接口，RuntimeService用于管理容器，ImageManagerService用于管理镜像

[RuntimeService代码](https://github.com/kubernetes/kubernetes/blob/9d0d2e8ece9bdd0cd8c23be2f36eee5473afc648/staging/src/k8s.io/cri-api/pkg/apis/services.go#L98)

[ImageManagerService](https://github.com/kubernetes/kubernetes/blob/9d0d2e8ece9bdd0cd8c23be2f36eee5473afc648/staging/src/k8s.io/cri-api/pkg/apis/services.go#L113)

