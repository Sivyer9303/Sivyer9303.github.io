### 分类

控制器主要有Deployment、StatefulSet、DaemonSet、ReplicationController、Job、CronJob等。

### Deployment

用于管理Pod。

#### 主要应用场景

1. 创建Pod和ReplicaSet
2. 滚动升级和回滚应用
3. 扩容或者缩容
4. 暂停和继续

#### yaml文件示例

```
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  replicas: 3
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.7.9
        ports:
        - containerPort: 80
```

#### 结构示意图



![deployment结构示意图](./deployment-cheatsheet.png)


#### 与Service、Pod之间的对应关系

一个Service可以有多个Deployment,一个Deployment可以对应多个Pod。

灰度发布实践：一个service创建3个Deployement(分别对应abc三个版本，且每个都设置为滚动升级)，每个Deployement创建2个Pod，发布a版本的Deployement，然后灰度验证（可以通过网关灰度、IP灰度，Istio灰度等），灰度完成之后，发布b版本，再次进行灰度验证，重复操作知道发布完成。

#### 参考文档地址

[Deployment · Kubernetes 中文指南——云原生应用架构实战手册 (jimmysong.io)](https://jimmysong.io/kubernetes-handbook/concepts/deployment.html)


### StatefulSet

带状态的集合，同样也是用于发布Pod，但与Deployement的区别之初在于，需要发布的Pod是有状态的，例如需要发布mysql，mysql如果两次发布没有部署到同一个Pod，其对应的volume可能就不同了，那么数据就发生了变化，将导致异常。此时就需要使用StatefulSet来控制有状态Pod的发布。


#### 与HeadlessService联动
